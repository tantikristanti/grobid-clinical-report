# General principles

The annotation guidelines describe the rules to follow for creating additional training data to be used with __grobid-medical-report__.

## Generating pre-annotated training data

The additional training data in Grobid is __not__ produced from scratch but rather from pre-annotated training data generated by the existing models. This process ensures the syntax of the new training data is correct, and the stream of the text will be easy to align with the text extracted from the PDF files.

For generating pre-annotated training files for Grobid based on the existing models, see the instructions for running the software in batch processes  [here](../Training-the-medical-report-models.md#generation-of-training-data) and [here](../Grobid-medical-report-batch.md#create-training).

After running the batch `createTraining` on a set of PDF files using methods for creating training data, each article comes with:

* PDF files used to generate the training data, for instance, `aphp.pdf`;

* A set of pre-annotated XML files with an extension `*.training.*.tei.xml` for the different GROBID models (e.g., `aphp.training.header.medical.tei.xml` for the pre-annotated header section). __These files need to be edited and corrected__ to get "gold-standard" training data;

* A set of feature files (without XML extension) contain the list of tokens with associated features for the training process (e.g., `aphp.training.header` for the header model). __These files should not be edited__.

The exact list of generated files depends on the structures occurring in the article. It is not unusual to not find all of the training file types listed below. The following is a complete list of training files that can be produced:

| name of file      | model | for the pre-annotated file     |
| :------------- | :---- | :------------- |
| `*.training.medical.tei.xml` | medical-report-segmenter | for the initial model used to segment a complete article into the principal zones |
| `*.training.header.medical.tei.xml` | header-medical-report | a pre-annotated file for the header model |
| `*.training.left.note.medical.tei.xml` | left-note-medical-report | a pre-annotated file for the left-note model |
| `*.training.full.medical.text.tei.xml` | full-medical-text | a pre-annotated file for the header model |
| `*.training.affiliation.tei.xml` | affiliation-address | for the detailed affiliation and address recognition |
| `*.training.medics.tei.xml` | medics | for the detailed medics recognition |
| `*.training.patients.tei.xml` | patients | for the detailed patients' recognition |
| `*.training.dateline.xml` | dateline | for the detailed structure of dates appearing with place names or other types of phrases |
| `*.training.full.medical.text.tei.xml` | full-medical-text | for the whole structured body |

These files must be reviewed and corrected manually before being added to the training data. Taking into account that exploiting any additional training data requires GROBID to re-create its models - by [retraining](../Training-the-medical-report-models.md) them.

## Correcting pre-annotated files

The most important principle when correcting the pre-annotated training data is to __keep the stream of text untouched__. Only the tags can be moved, while the text itself shall not be modified or corrected. The stream of the text present in the training file as the Pdf extraction is similar to the stream of text that Grobid has to process. It is thus important to have Grobid trained on this real-world input, even if they contain OCR errors, noise, unknown Unicode characters, etc.   

There are two exceptions to this main rule:

* Actual __end-of-lines__ from the PDF files are indicated by element `<lb/>`. These tags should be considered as part of the stream of text, and they should not be moved or removed concerning the overall text stream. 

* In the TEI/XML files, end-of-line is equivalent to a space character. It is possible to add or remove end-of-line characters, as long as the spacing is preserved. For instance:

```xml
 	<title level="a">In XML training files, end-of-line and space are the same</title> <lb/> <author>Kermitt Jr</author> <lb/> <date>2017</date> 
```

is equivalent to 

```xml
<title level="a">In XML training files, end-of-line and space are 
	the same</title> <lb/> 
	<author>Kermitt Jr</author> 
	<lb/> 
	
	<date>2017</date> 
```

In the standard Grobid installation, examples of existing annotations for each model is under `grobid/grobid-trainer/resources/dataset/*MODEL*/`. Meanwhile, for the grobid-medical-report, the annotated data is under `grobid-medical-report/resources/dataset/*MODEL*/`

We cannot add XML files as training and evaluation datasets for the following cases:
* If XML files are incorrectly produced  (e.g., `*.training.header.medical.xml` is produced after a chunk of text wrongly identified as the header section), then these files must be removed.

* If XML files are missing (e.g., a chunk of text should be as the header section, but Grobid predicted it as a note), then the additional XML file `*.training.header.medical.xml` shall not be created.

XML files can be modified or deleted, but they cannot be created manually.

In the next sections, the annotation guidelines for each model are presented with various examples.
